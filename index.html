function buildChartMes(rows) {
  const base = rowsWithPedido(rows);

  // mes -> {total, cumplidos}
  const aggMes = new Map();
  const monthsSet = new Set();

  for (const r of base) {
    const estado = clean(r[ESTADO_COL]).toUpperCase();

    const d = parseDateDMY(r[FECHA_COL]);
    if (!d) continue;

    const mk = monthKey(d);
    monthsSet.add(mk);

    if (!aggMes.has(mk)) aggMes.set(mk, { total: 0, cumplidos: 0 });
    const cell = aggMes.get(mk);

    cell.total += 1;
    if (estado === CUMPLIDO_VALUE) cell.cumplidos += 1;
  }

  const months = [...monthsSet].sort();

  // % cumplimiento por mes
  const values = months.map(mk => {
    const v = aggMes.get(mk);
    if (!v || v.total === 0) return 0;
    return Math.round((v.cumplidos / v.total) * 1000) / 10; // %
  });

  const ctx = document.getElementById("chartMes").getContext("2d");
  if (chartMes) chartMes.destroy();

  chartMes = new Chart(ctx, {
    type: "bar", // ğŸ‘ˆ columnas
    data: {
      labels: months,
      datasets: [{
        label: "% Cumplimiento",
        data: values
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: { beginAtZero: true, max: 100, ticks: { callback: v => v + "%" } }
      },
      plugins: {
        legend: { display: false },
        tooltip: { callbacks: { label: (c) => `${c.parsed.y}%` } }
      }
    }
  });
}



